import asyncio
import re
import urllib.parse
import aiohttp
import queue

class QueueUtil:
    def __init__(self):
        self.queue = queue.Queue()

    def put(self, data):
        self.queue.put(data)

    def get(self):
        while not self.queue.empty():
            if self.queue.qsize() < 10:
                import time
                time.sleep(5)
            yield self.queue.get()


class Crawler:
    def __init__(self, maxtasks=100):
        self.rooturl = None
        self.loop = None
        self.todo = set()
        self.busy = set()
        self.done = {}
        self.tasks = set()
        self.sem = asyncio.Semaphore(maxtasks, loop=self.loop)
        self.session = aiohttp.ClientSession(loop=self.loop)

    @asyncio.coroutine
    def run(self):
        for url in self.rooturl:
            t = asyncio.ensure_future(self.addurls([(url, '')]),
                                  loop=self.loop)
        tas = []
        tas.append(t)
        yield from asyncio.sleep(1, loop=self.loop)
        while self.busy:
            yield from asyncio.sleep(1, loop=self.loop)
        yield from self.session.close()

        yield from tas
        self.loop.stop()

    @asyncio.coroutine
    def addurls(self, urls):
        for url, parenturl in urls:
            url = urllib.parse.urljoin(parenturl, url)
            url, frag = urllib.parse.urldefrag(url)
            if (url not in self.busy and
                    url not in self.done and
                    url not in self.todo):
                self.todo.add(url)
                yield from self.sem.acquire()
                task = asyncio.ensure_future(self.process(url), loop=self.loop)
                task.add_done_callback(lambda t: self.sem.release())
                task.add_done_callback(self.tasks.remove)
                self.tasks.add(task)

    @asyncio.coroutine
    def response(self, item):
        pass

    @asyncio.coroutine
    def process(self, url):

        self.todo.remove(url)
        self.busy.add(url)
        try:
            resp = yield from self.session.get(url)
        except Exception as exc:
            print('...', url, 'has error', repr(str(exc)))
            self.done[url] = False
        else:
            if (resp.status == 200 and
                    ('text/html' in resp.headers.get('content-type'))):
                html = (yield from resp.read())
                data = html.decode('utf-8', 'replace')
                #
                # urls = re.findall(r'(?i)href=["\']?([^\s"\'<>]+)', data)
                # asyncio.Task(self.addurls([(u, url) for u in urls]))
                try:
                    reg = '<meta .*(http-equiv="?Content-Type"?.*)?charset="?([a-zA-Z0-9_-]+)"?'
                    charset = re.findall(reg,data)[0][1]
                except:
                    charset = ""
                if charset != "":
                    charset = charset.lower()
                else:
                    charset = "utf-8"
                data = html.decode(charset, 'replace')

                asyncio.ensure_future(self.response((url,data)), loop=self.loop)

            resp.close()
            self.done[url] = True
        self.busy.remove(url)
        print(len(self.done), 'completed tasks,', len(self.tasks),
              'still pending, todo', len(self.todo))


class Crawleruning(Crawler):

    def __init__(self):
        super(Crawleruning, self).__init__()

    @asyncio.coroutine
    def response(self, item):
        print(item)


    def main(self,loop):
        self.rooturl = ['http://news.sohu.com/',
                'http://news.sohu.com/s2018/guoqing69/index.shtml',
                'http://news.sohu.com/s2018/wrj/index.shtml',
                'http://news.sohu.com/upload/itoolbar/cms/itoolbar.201410281438.css',
                'http://news.sohu.com/s2018/0333/s550975000/index.shtml',
                'http://news.sohu.com/s2018/gaige40/index.shtml',
                'http://news.sohu.com/s2018/lianghui/index.shtml',
                'http://news.sohu.com/upload/yursile/wrj43/css/index.css',
                'http://news.sohu.com/upload/wrj20180926/wrj.css',
                'http://news.sohu.com/upload/20170828/idangerous.swiper2.7.6.css',
                'http://news.sohu.com/upload/20170828/animate.min.css',
                'http://news.sohu.com/upload/20170828/style.css',
                'http://news.sohu.com/wurenji/index.shtml',
                'http://news.sohu.com/s2017/wrj/index.shtml',
                'http://news.sohu.com/upload/yursile/kywrj3/css/index.css',
                'http://news.sohu.com/upload/20180622/swiper-4.2.2.min.css',
                'http://news.sohu.com/upload/20180622/index.css',
                'http://news.sohu.com/20170316/n483500383.shtml',
                'http://news.sohu.com/20170317/n483635382.shtml',
                'http://news.sohu.com/20170317/n483635500.shtml',
                'http://news.sohu.com/20170315/n483432378.shtml',
                'http://news.sohu.com/20170315/n483459308.shtml',
                'http://news.sohu.com/20170315/n483398773.shtml',
                'http://news.sohu.com/20170315/n483393163.shtml',
                'http://news.sohu.com/20170315/n483389503.shtml',
                'http://news.sohu.com/20170315/n483397070.shtml',
                'http://news.sohu.com/20170315/n483406042.shtml',
                'http://news.sohu.com/20170315/n483407108.shtml',
                'http://news.sohu.com/20170315/n483388750.shtml',
                'http://news.sohu.com/20170315/n483393421.shtml',
                'http://news.sohu.com/20170315/n483382738.shtml',
                'http://news.sohu.com/20170315/n483377960.shtml',
                'http://news.sohu.com/20170316/n483489108.shtml',
                'http://news.sohu.com/20170316/n483595543.shtml',
                'http://news.sohu.com/s2017/4912/s483316258/index.shtml',
                'http://news.sohu.com/s2017/4912/s483134675/index.shtml',
                'http://news.sohu.com/s2017/4912/s483293130/index.shtml',
                'http://news.sohu.com/20170401/n486016546.shtml',
                'http://news.sohu.com/20151030/n424714649.shtml',
                'http://news.sohu.com/20150215/n409031140.shtml',
                'http://news.sohu.com/20151106/n425494425.shtml',
                'http://news.sohu.com/20141212/n406879487.shtml',
                'http://news.sohu.com/20170413/n488164574.shtml',
                'http://news.sohu.com/20130122/n364309530.shtml',
                'http://news.sohu.com/20130415/n372678706.shtml',
                'http://news.sohu.com/20140415/n398238288.shtml',
                'http://news.sohu.com/20150126/n408080444.shtml',
                'http://news.sohu.com/s2013/4993/s389757092/index.shtml',
                'http://news.sohu.com/s2013/4993/s389753626/index.shtml',
                'http://news.sohu.com/20150609/n414655588.shtml',
                'http://news.sohu.com/s2017/wrje/index.shtml',
                'http://news.sohu.com/upload/ghostren/global.css',
                'http://news.sohu.com/upload/wurenji2015623/css/style.css',
                'http://news.sohu.com/wurenji_b/index.shtml',
                'http://news.sohu.com/s2018/8277/s532583527/index.shtml',
                'http://news.sohu.com/s2018/8277/s532861788/index.shtml',
                'http://news.sohu.com/20170317/+e(u.href)+',
                'http://news.sohu.com/20170317/',
                'http://news.sohu.com/upload/article/2012/style.v20150623.css',
                'http://news.sohu.com/guoneixinwen.shtml',
                'http://news.sohu.com/guoneixinwen/gaocengdongtai/',
                'http://news.sohu.com/guojixinwen.shtml',
                'http://news.sohu.com/shehuixinwen.shtml',
                'http://news.sohu.com/upload/among/lastpagevideo580_0416.css',
                'http://news.sohu.com/20170316/+e(u.href)+',
                'http://news.sohu.com/20170316/',
                'http://news.sohu.com/upload/zhengyufeng/xinwenerjiye/style1.css',
                'http://news.sohu.com/s2005/shishi.shtml',
                'http://news.sohu.com/scroll/',
                'http://news.sohu.com/special.shtml',
                'http://news.sohu.com/dianjijinri/',
                'http://news.sohu.com/pictalk/',
                'http://news.sohu.com/newsmaker_list/',
                'http://news.sohu.com/mindiao/',
                'http://news.sohu.com/photo/',
                'http://news.sohu.com/pad/',
                'http://news.sohu.com/20181220/n558771727.shtml',
                'http://news.sohu.com/20180324/n533151619.shtml',
                'http://news.sohu.com/20180320/n532913865.shtml',
                'http://news.sohu.com/20180304/n532005744.shtml',
                'http://news.sohu.com/20180303/n531976409.shtml',
                'http://news.sohu.com/20180219/n531137356.shtml',
                'http://news.sohu.com/20180219/n531126071.shtml',
                'http://news.sohu.com/20180217/n531088621.shtml',
                'http://news.sohu.com/20180217/n531088559.shtml',
                'http://news.sohu.com/20180216/n531029435.shtml',
                'http://news.sohu.com/20180215/n530988819.shtml',
                'http://news.sohu.com/20180215/n530987249.shtml',
                'http://news.sohu.com/20180128/n529454812.shtml',
                'http://news.sohu.com/20180107/n527450434.shtml',
                'http://news.sohu.com/20171226/n526348972.shtml',
                'http://news.sohu.com/url',
                'http://news.sohu.com/20161107/n472457134.shtml',
                'http://news.sohu.com/20161107/n472464224.shtml',
                'http://news.sohu.com/20161107/n472456625.shtml',
                'http://news.sohu.com/20161107/n472452556.shtml',
                'http://news.sohu.com/20161106/n472442041.shtml',
                'http://news.sohu.com/20161114/n473075343.shtml',
                'http://news.sohu.com/20160705/n457891463.shtml',
                'http://news.sohu.com/20161114/n473080415.shtml',
                'http://news.sohu.com/20161112/n473015294.shtml',
                'http://news.sohu.com/20161114/n473158426.shtml',
                'http://news.sohu.com/20161114/n473091222.shtml',
                'http://news.sohu.com/20161114/n473079019.shtml',
                'http://news.sohu.com/20161113/n473051793.shtml',
                'http://news.sohu.com/20161114/n473075375.shtml',
                'http://news.sohu.com/20161113/n473070688.shtml',
                'http://news.sohu.com/20161111/n472959687.shtml',
                'http://news.sohu.com/20161114/n473127950.shtml',
                'http://news.sohu.com/20161114/n473137341.shtml',
                'http://news.sohu.com/20161114/n473075549.shtml',
                'http://news.sohu.com/20161114/n473100932.shtml',
                'http://news.sohu.com/20161114/n473075915.shtml',
                'http://news.sohu.com/20161114/n473076021.shtml',
                'http://news.sohu.com/20161114/n473075717.shtml',
                'http://news.sohu.com/20161114/n473117702.shtml',
                'http://news.sohu.com/20160308/n439756751.shtml',
                'http://news.sohu.com/20161114/n473082947.shtml',
                'http://news.sohu.com/20161114/n473100533.shtml',
                'http://news.sohu.com/20161114/n473075984.shtml',
                'http://news.sohu.com/20161114/n473082475.shtml',
                'http://news.sohu.com/20161113/n473046926.shtml',
                'http://news.sohu.com/20160728/n461503761.shtml',
                'http://news.sohu.com/20161114/n473113911.shtml',
                'http://news.sohu.com/20161114/n473113594.shtml',
                'http://news.sohu.com/20161102/n472124415.shtml',
                'http://news.sohu.com/20170315/+e(u.href)+',
                'http://news.sohu.com/scroll/[];AD.href2=[];AD.imp=[];',
                'http://news.sohu.com/s2017/lianghui/',
                'http://news.sohu.com/upload/img071012/global.css',
                'http://news.sohu.com/upload/2013/style.css',
                'http://news.sohu.com/upload/2013page/c.css',
                'http://news.sohu.com/20161113/n473061234.shtml',
                'http://news.sohu.com/20150825/n419728741.shtml',
                'http://news.sohu.com/20161114/n473130661.shtml',
                'http://news.sohu.com/20170315/',
                'http://news.sohu.com/s2017/4912/s480195190/',
                'http://news.sohu.com/s2005/zixun.shtml',
                'http://news.sohu.com/s2005/gangaotai.shtml',
                'http://news.sohu.com/s2017/4912/s482352663/index.shtml',
                'http://news.sohu.com/20161114/n473113667.shtml',
                'http://news.sohu.com/s2017/g20/index.shtml',
                'http://news.sohu.com/s2017/4912/s482333088/index.shtml',
                'http://news.sohu.com/20161114/n473091415.shtml',
                'http://news.sohu.com/20161114/n473081372.shtml',
                'http://news.sohu.com/20140415/+e(u.href)+',
                'http://news.sohu.com/s2013/sanzhongquanhui/',
                'http://news.sohu.com/upload/among/reset.css',
                'http://news.sohu.com/bagua.shtml',
                'http://news.sohu.com/guoneirenshi/index.shtml',
                'http://news.sohu.com/1/0104/58/subject218715899.shtml',
                'http://news.sohu.com/20151030/+e(u.href)+',
                'http://news.sohu.com/20150126/+e(u.href)+',
                'http://news.sohu.com/20161111/n472949279.shtml',
                'http://news.sohu.com/20170526/n494535255.shtml',
                'http://news.sohu.com/s2017/jianjun90/index.shtml',
                'http://news.sohu.com/s2017/gaige/index.shtml',
                'http://news.sohu.com/s2017/xghg20/index.shtml',
                'http://news.sohu.com/20161114/+e(u.href)+',
                'http://news.sohu.com/20161114/',
                'http://news.sohu.com/upload/zhengyufeng/jianyi/style1.css',
                'http://news.sohu.com/s2017/4912/s482998979/index.shtml',
                'http://news.sohu.com/20170401/+e(u.href)+',
                'http://news.sohu.com/20170401/',
                'http://news.sohu.com/20150215/+e(u.href)+',
                'http://news.sohu.com/20151030/',
                'http://news.sohu.com/1/0903/63/subject212846373.shtml',
                'http://news.sohu.com/20170525/n494380374.shtml',
                'http://news.sohu.com/20150609/+e(u.href)+',
                'http://news.sohu.com/s2017/4912/s482354064/index.shtml',
                'http://news.sohu.com/s2017/4912/s482341260/index.shtml',
                'http://news.sohu.com/20161107/n472502975.shtml',
                'http://news.sohu.com/20180128/+e(u.href)+',
                'http://news.sohu.com/20170315/n483434284.shtml',
                'http://news.sohu.com/s2016/g20/index.shtml',
                'http://news.sohu.com/wimages/ui.css',
                'http://news.sohu.com/20170320/n483869665.shtml',
                'http://news.sohu.com/20131113/n390034185.shtml',
                'http://news.sohu.com/20131101/n389411508.shtml',
                'http://news.sohu.com/20170315/n483367064.shtml',
                'http://news.sohu.com/guoneirenshi/',
                'http://news.sohu.com/sp/',
                'http://news.sohu.com/20150215/',
                'http://news.sohu.com/s2006/yuwaihuawen/',
                'http://news.sohu.com/20180219/+e(u.href)+',
                'http://news.sohu.com/20161113/+e(u.href)+',
                'http://news.sohu.com/s2005/zhoubian.shtml',
                'http://news.sohu.com/20161112/n473003481.shtml',
                'http://news.sohu.com/20161114/n473084487.shtml',
                'http://news.sohu.com/20161026/n471371773.shtml',
                'http://news.sohu.com/20181220/+e(u.href)+',
                'http://news.sohu.com/20180217/',
                'http://news.sohu.com/20161111/+e(u.href)+',
                'http://news.sohu.com/20161110/n472849630.shtml',
                'http://news.sohu.com/20180324/+e(u.href)+',
                'http://news.sohu.com/s2013/jueding/',
                'http://news.sohu.com/upload/2013page/c2.css',
                'http://news.sohu.com/20180107/+e(u.href)+',
                'http://news.sohu.com/20161112/n473000682.shtml',
                'http://news.sohu.com/20161107/n472458639.shtml',
                'http://news.sohu.com/20161114/n473107773.shtml',
                'http://news.sohu.com/s2016/mingshuoba/',
                'http://news.sohu.com/20161108/n472551513.shtml',
                'http://news.sohu.com/s2005/guojihuabian.shtml',
                'http://news.sohu.com/20161114/n473083951.shtml',
                'http://news.sohu.com/s2017/4912/s482344567/index.shtml',
                'http://news.sohu.com/20161107/n472514207.shtml',
                'http://news.sohu.com/20180303/+e(u.href)+',
                'http://news.sohu.com/20180303/',
                'http://news.sohu.com/20161114/n473075653.shtml',
                'http://news.sohu.com/20161112/n472991487.shtml',
                'http://news.sohu.com/20161114/n473075910.shtml',
                'http://news.sohu.com/20160308/+e(u.href)+',
                'http://news.sohu.com/20180216/+e(u.href)+',
                'http://news.sohu.com/20180215/',
                'http://news.sohu.com/20180128/',
                'http://news.sohu.com/20130122/+e(u.href)+',
                'http://news.sohu.com/20130415/+e(u.href)+',
                'http://news.sohu.com/20160728/+e(u.href)+',
                'http://news.sohu.com/20160728/',
                'http://news.sohu.com/1/0504/65/subject220076572.shtml',
                'http://news.sohu.com/20161107/+e(u.href)+',
                'http://news.sohu.com/20160729/n461674102.shtml',
                'http://news.sohu.com/20160725/n460809141.shtml',
                'http://news.sohu.com/20160712/n458811310.shtml',
                'http://news.sohu.com/20160602/n452431604.shtml',
                'http://news.sohu.com/graphics/',
                'http://news.sohu.com/20161107/n472452464.shtml',
                'http://news.sohu.com/20161102/n472096672.shtml',
                'http://news.sohu.com/20170525/+e(u.href)+',
                'http://news.sohu.com/20161106/+e(u.href)+',
                'http://news.sohu.com/20150825/+e(u.href)+',
                'http://news.sohu.com/20161113/n473037821.shtml',
                'http://news.sohu.com/20161102/+e(u.href)+',
                'http://news.sohu.com/20170526/+e(u.href)+',
                'http://news.sohu.com/20170526/',
                'http://news.sohu.com/20160705/+e(u.href)+',
                'http://news.sohu.com/20160705/',
                'http://news.sohu.com/20161113/n473046185.shtml',
                'http://news.sohu.com/20161111/n472948723.shtml',
                'http://news.sohu.com/20161112/+e(u.href)+',
                'http://news.sohu.com/20171003/n515929517.shtml',
                'http://news.sohu.com/s2013/bonus/',
                'http://news.sohu.com/20161114/n473075582.shtml',
                'http://news.sohu.com/20180219/',
                'http://news.sohu.com/20171226/+e(u.href)+',
                'http://news.sohu.com/20171226/',
                'http://news.sohu.com/20170307/n482604499.shtml',
                'http://news.sohu.com/20170222/n481455026.shtml',
                'http://news.sohu.com/20170218/n481049845.shtml',
                'http://news.sohu.com/20170207/n480138226.shtml',
                'http://news.sohu.com/s2017/6758/s498339596/index.shtml',
                'http://news.sohu.com/20170626/n498619073.shtml',
                'http://news.sohu.com/20170620/n497769755.shtml',
                'http://news.sohu.com/20170313/n483114827.shtml',
                'http://news.sohu.com/20170310/n482907980.shtml',
                'http://news.sohu.com/20170310/n482894533.shtml',
                'http://news.sohu.com/20170803/n505265924.shtml',
                'http://news.sohu.com/20170719/n502629005.shtml',
                'http://news.sohu.com/20170719/n502627449.shtml',
                'http://news.sohu.com/20131113/+e(u.href)+',
                'http://news.sohu.com/20131113/',
                'http://news.sohu.com/20170320/+e(u.href)+',
                'http://news.sohu.com/20170320/',
                'http://news.sohu.com/20161113/n473048429.shtml',
                'http://news.sohu.com/20161113/n473028985.shtml',
                'http://news.sohu.com/20161113/n473028948.shtml',
                'http://news.sohu.com/20141212/+e(u.href)+',
                'http://news.sohu.com/20161103/n472159064.shtml',
                'http://news.sohu.com/20160828/n466428095.shtml',
                'http://news.sohu.com/photo_list/',
                'http://news.sohu.com/cp',
                'http://news.sohu.com/sp',
                'http://news.sohu.com/wp',
                'http://news.sohu.com/20121219/n360957072.shtml',
                'http://news.sohu.com/20161026/+e(u.href)+',
                'http://news.sohu.com/20161026/',
                'http://news.sohu.com/20161114/n473072442.shtml',
                'http://news.sohu.com/20170516/n493212660.shtml',
                'http://news.sohu.com/1/0903/62/subject212846206.shtml',
                'http://news.sohu.com/s2008/6339/s258284307/',
                'http://news.sohu.com/s2008/reporterblog/',
                'http://news.sohu.com/s2016/xjpzglz/',
                'http://news.sohu.com/s2008/guoneivideo/',
                'http://news.sohu.com/20161111/n472909819.shtml',
                'http://news.sohu.com/20161110/n472765032.shtml',
                'http://news.sohu.com/20161109/n472667660.shtml',
                'http://news.sohu.com/20161025/n471298669.shtml',
                'http://news.sohu.com/20161012/n470078411.shtml',
                'http://news.sohu.com/20161112/n472974781.shtml',
                'http://news.sohu.com/20161104/n472268010.shtml',
                'http://news.sohu.com/20161102/n472071728.shtml',
                'http://news.sohu.com/20161114/n473075703.shtml',
                'http://news.sohu.com/20170516/n493202382.shtml',
                'http://news.sohu.com/20161102/',
                'http://news.sohu.com/20161110/+e(u.href)+',
                'http://news.sohu.com/20161110/',
                'http://news.sohu.com/20161102/n472081381.shtml',
                'http://news.sohu.com/upload/ghostren/shuzizidao/style0815.css',
                'http://news.sohu.com/s2016/meiguodaxuan/',
                'http://news.sohu.com/20160826/n466176929.shtml',
                'http://news.sohu.com/20160715/n459490585.shtml',
                'http://news.sohu.com/20160713/n458965886.shtml',
                'http://news.sohu.com/20161107/n472525674.shtml',
                'http://news.sohu.com/20190114/n560949049.shtml',
                'http://news.sohu.com/20181220/',
                'http://news.sohu.com/s2016/jianyanzongli/',
                'http://news.sohu.com/s2018/2022/s558771214/',
                'http://news.sohu.com/20161111/',
                'http://news.sohu.com/20131120/n390436721.shtml',
                'http://news.sohu.com/s2011/matrix-huizong/',
                'http://news.sohu.com/20130510/n375477332.shtml',
                'http://news.sohu.com/s2015/dianji-1677/',
                'http://news.sohu.com/s2015/shuzi-380/',
                'http://news.sohu.com/s2015/newsmaker344/',
                'http://news.sohu.com/s2015/yaoyan-127/',
                'http://news.sohu.com/20170310/+e(u.href)+',
                'http://news.sohu.com/20170310/',
                'http://news.sohu.com/20170310/n482881089.shtml',
                'http://news.sohu.com/20170309/n482816540.shtml',
                'http://news.sohu.com/20170219/n481097328.shtml',
                'http://news.sohu.com/20170310/n482906986.shtml',
                'http://news.sohu.com/20170313/+e(u.href)+',
                'http://news.sohu.com/20170207/+e(u.href)+',
                'http://news.sohu.com/20170222/+e(u.href)+',
                'http://news.sohu.com/20170222/',
                'http://news.sohu.com/20170307/+e(u.href)+',
                'http://news.sohu.com/20170307/',
                'http://news.sohu.com/20160921/n468837270.shtml',
                'http://news.sohu.com/20180217/+e(u.href)+',
                'http://news.sohu.com/20161107/n472495984.shtml',
                'http://news.sohu.com/20151108/n425641832.shtml',
                'http://news.sohu.com/20150404/n410823396.shtml',
                'http://news.sohu.com/20141223/n407195909.shtml',
                'http://news.sohu.com/20141224/n407244254.shtml',
                'http://news.sohu.com/1/0903/62/url',
                'http://news.sohu.com/20170516/+e(u.href)+',
                'http://news.sohu.com/20170516/',
                'http://news.sohu.com/20170510/n492456300.shtml',
                'http://news.sohu.com/20161010/n469846440.shtml',
                'http://news.sohu.com/s2009/picsp/',
                'http://news.sohu.com/20161112/n472989340.shtml',
                'http://news.sohu.com/20161111/n472902225.shtml',
                'http://news.sohu.com/20161108/n472591956.shtml',
                'http://news.sohu.com/20161108/+e(u.href)+',
                'http://news.sohu.com/s2015/g20/',
                'http://news.sohu.com/20161025/n471237793.shtml',
                'http://news.sohu.com/20161109/+e(u.href)+',
                'http://news.sohu.com/20161109/',
                'http://news.sohu.com/20161109/n472650047.shtml',
                'http://news.sohu.com/20161025/+e(u.href)+',
                'http://news.sohu.com/20161102/n472062306.shtml',
                'http://news.sohu.com/20161102/n472062285.shtml',
                'http://news.sohu.com/20161106/n472434964.shtml',
                'http://news.sohu.com/20160602/+e(u.href)+',
                'http://news.sohu.com/s2008/exclusivenews/',
                'http://news.sohu.com/20160712/+e(u.href)+',
                'http://news.sohu.com/20160725/+e(u.href)+',
                'http://news.sohu.com/20160729/+e(u.href)+',
                'http://news.sohu.com/20160729/',
                'http://news.sohu.com/20161111/n472882326.shtml',
                'http://news.sohu.com/20141212/',
                'http://news.sohu.com/20141211/n406870140.shtml',
                'http://news.sohu.com/20141206/n406710790.shtml',
                'http://news.sohu.com/20190114/+e(u.href)+',
                'http://news.sohu.com/20170626/+e(u.href)+',
                'http://news.sohu.com/upload/guoji-world/2.css',
                'http://news.sohu.com/20160826/+e(u.href)+',
                'http://news.sohu.com/20170719/+e(u.href)+',
                'http://news.sohu.com/20171003/+e(u.href)+',
                'http://news.sohu.com/s2017/jianjun90/',
                'http://news.sohu.com/20131031/n389343965.shtml',
                'http://news.sohu.com/s2008/guoneivideo/index.shtml',
                'http://news.sohu.com/20170803/+e(u.href)+',
                'http://news.sohu.com/s2009/sss/',
                'http://news.sohu.com/wp/',
                'http://news.sohu.com/20170310/n482899189.shtml',
                'http://news.sohu.com/20131120/+e(u.href)+',
                'http://news.sohu.com/20161103/+e(u.href)+',
                'http://news.sohu.com/20161112/n472980994.shtml',
                'http://news.sohu.com/20170114/n478717146.shtml',
                'http://news.sohu.com/20170620/+e(u.href)+',
                'http://news.sohu.com/20170620/',
                'http://news.sohu.com/20130510/+e(u.href)+',
                'http://news.sohu.com/20121219/+e(u.href)+',
                'http://news.sohu.com/20160828/+e(u.href)+',
                'http://news.sohu.com/20161027/n471493234.shtml',
                'http://news.sohu.com/20161111/n472876689.shtml',
                'http://news.sohu.com/20160901/n467239262.shtml',
                'http://news.sohu.com/20161112/n472974345.shtml',
                'http://news.sohu.com/20161111/n472935788.shtml',
                'http://news.sohu.com/20161111/n472878334.shtml',
                'http://news.sohu.com/xinjingbao.shtml',
                'http://news.sohu.com/upload/zhengyufeng/djjr/style9.css',
                'http://news.sohu.com/s2014/dianji-1677/index.shtml',
                'http://news.sohu.com/s2016/dianji-1930/index.shtml',
                'http://news.sohu.com/s2016/dianji-1929/index.shtml',
                'http://news.sohu.com/s2016/dianji-1928/index.shtml',
                'http://news.sohu.com/upload/matrix2014/c.css',
                'http://news.sohu.com/matrix/index.shtml',
                'http://news.sohu.com/cp/',
                'http://news.sohu.com/20161113/n473055885.shtml',
                'http://news.sohu.com/20161104/+e(u.href)+',
                'http://news.sohu.com/20161104/',
                'http://news.sohu.com/20161111/n472924193.shtml',
                'http://news.sohu.com/20161102/n472066978.shtml',
                'http://news.sohu.com/upload/jianyanzongli/style.css',
                'http://news.sohu.com/20161111/n472922858.shtml',
                'http://news.sohu.com/upload/ghostren/yaoyan/style917.css',
                'http://news.sohu.com/20170412/n487904571.shtml',
                'http://news.sohu.com/20170412/n487862435.shtml',
                'http://news.sohu.com/upload/itoolbar/channel/itoolbar.201308301051.css',
                'http://news.sohu.com/20161012/+e(u.href)+',
                'http://news.sohu.com/upload/jieli/global2013.css',
                'http://news.sohu.com/upload/dsr2013/style.css',
                'http://news.sohu.com/matrix/',
                'http://news.sohu.com/20160715/+e(u.href)+',
                'http://news.sohu.com/20160715/',
                'http://news.sohu.com/20161101/n471946595.shtml',
                'http://news.sohu.com/20161019/n470691138.shtml',
                'http://news.sohu.com/20161019/n470665987.shtml',
                'http://news.sohu.com/20161017/n470454615.shtml',
                'http://news.sohu.com/20120210/n334390476.shtml',
                'http://news.sohu.com/20110704/n312466535.shtml',
                'http://news.sohu.com/20110414/n305795436.shtml',
                'http://news.sohu.com/20160125/n435778889.shtml',
                'http://news.sohu.com/20161019/n470684722.shtml',
                'http://news.sohu.com/20170219/+e(u.href)+',
                'http://news.sohu.com/20170219/',
                'http://news.sohu.com/20170309/+e(u.href)+',
                'http://news.sohu.com/20170309/',
                'http://news.sohu.com/20141206/+e(u.href)+',
                'http://news.sohu.com/20141211/+e(u.href)+',
                'http://news.sohu.com/20170309/n482761475.shtml',
                'http://news.sohu.com/20161012/n470034518.shtml',
                'http://news.sohu.com/upload/lj/global.1.css',
                'http://news.sohu.com/20161027/+e(u.href)+',
                'http://news.sohu.com/20161027/',
                'http://news.sohu.com/20161026/n471397473.shtml',
                'http://news.sohu.com/20161025/n471238163.shtml',
                'http://news.sohu.com/s2015/xijinping/',
                'http://news.sohu.com/s2015/xijinpingchufang/',
                'http://news.sohu.com/s2015/zhnglalunyan/',
                'http://news.sohu.com/20151117/n426670496.shtml',
                'http://news.sohu.com/20151117/n426692528.shtml',
                'http://news.sohu.com/20170510/+e(u.href)+',
                'http://news.sohu.com/20170510/',
                'http://news.sohu.com/20150404/+e(u.href)+',
                'http://news.sohu.com/20150404/',
                'http://news.sohu.com/20151108/+e(u.href)+',
                'http://news.sohu.com/20130215/n366114244.shtml',
                'http://news.sohu.com/wp/index.shtml',
                'http://news.sohu.com/20161106/n472406073.shtml',
                'http://news.sohu.com/20161101/n472057955.shtml',
                'http://news.sohu.com/20161029/n471729610.shtml',
                'http://news.sohu.com/upload/lj/global.css',
                'http://news.sohu.com/upload/lj/szzd2011/style2.css',
                'http://news.sohu.com/20161111/n472879917.shtml',
                'http://news.sohu.com/20161111/n472875888.shtml',
                'http://news.sohu.com/20161111/n472873233.shtml',
                'http://news.sohu.com/20170719/n502642106.shtml',
                'http://news.sohu.com/20170719/n502640388.shtml',
                'http://news.sohu.com/20170719/n502640140.shtml',
                'http://news.sohu.com/s2017/3876/s502601358/index.shtml',
                'http://news.sohu.com/20170719/n502634070.shtml',
                'http://news.sohu.com/20161010/+e(u.href)+',
                'http://news.sohu.com/20161010/',
                'http://news.sohu.com/20161010/n469840682.shtml',
                'http://news.sohu.com/20161101/n471934380.shtml',
                'http://news.sohu.com/20161027/n471483756.shtml',
                'http://news.sohu.com/20161021/n470867239.shtml',
                'http://news.sohu.com/20141224/+e(u.href)+',
                'http://news.sohu.com/20141223/+e(u.href)+',
                'http://news.sohu.com/20161024/n471189262.shtml',
                'http://news.sohu.com/20161023/n471051035.shtml',
                'http://news.sohu.com/20161020/n470730962.shtml',
                'http://news.sohu.com/20161018/n470574988.shtml',
                'http://news.sohu.com/s2015/wuzhongquanhui/',
                'http://news.sohu.com/20161028/n471666146.shtml',
                'http://news.sohu.com/20161110/n472830959.shtml',
                'http://news.sohu.com/20161110/n472766926.shtml',
                'http://news.sohu.com/20160125/+e(u.href)+',
                'http://news.sohu.com/20161104/n472286582.shtml',
                'http://news.sohu.com/20161107/n472480192.shtml',
                'http://news.sohu.com/20161107/n472463761.shtml',
                'http://news.sohu.com/20170508/n492230527.shtml',
                'http://news.sohu.com/s2014/xjpg20/',
                'http://news.sohu.com/s2016/dianji-1926/index.shtml',
                'http://news.sohu.com/20161027/n471508412.shtml',
                'http://news.sohu.com/cp/index.shtml',
                'http://news.sohu.com/cp/url',
                'http://news.sohu.com/1/0504/52/subject220075254.shtml',
                'http://news.sohu.com/20050620/n226001836.shtml',
                'http://news.sohu.com/20050617/n225975669.shtml',
                'http://news.sohu.com/20161019/+e(u.href)+',
                'http://news.sohu.com/20161019/',
                'http://news.sohu.com/1/1299/66/subject143746646.shtml',
                'http://news.sohu.com/20130415/',
                'http://news.sohu.com/20170114/+e(u.href)+',
                'http://news.sohu.com/20161026/n471328462.shtml',
                'http://news.sohu.com/20161106/n472409253.shtml',
                'http://news.sohu.com/20161106/n472405983.shtml',
                'http://news.sohu.com/20161103/n472241199.shtml',
                'http://news.sohu.com/s2017/4912/s480195193/',
                'http://news.sohu.com/20170223/n481496942.shtml',
                'http://news.sohu.com/20170222/n481419760.shtml',
                'http://news.sohu.com/20161017/n470432079.shtml',
                'http://news.sohu.com/20161010/n469843699.shtml',
                'http://news.sohu.com/20161009/n469824921.shtml',
                'http://news.sohu.com/20161107/',
                'http://news.sohu.com/20161031/n471854413.shtml',
                'http://news.sohu.com/20161111/n472867944.shtml',
                'http://news.sohu.com/20161111/n472866527.shtml',
                'http://news.sohu.com/20161101/+e(u.href)+',
                'http://news.sohu.com/20160901/+e(u.href)+',
                'http://news.sohu.com/20170218/m.sohu.com/a/285430905_120078003',
                'http://news.sohu.com/20161025/n471267099.shtml',
                'http://news.sohu.com/20131120/',
                'http://news.sohu.com/20161110/n472800764.shtml',
                'http://news.sohu.com/20170412/+e(u.href)+',
                'http://news.sohu.com/20170412/',
                'http://news.sohu.com/s2016/5083/s449876368/',
                'http://news.sohu.com/20170412/n487839340.shtml',
                'http://news.sohu.com/20161111/n472861997.shtml',
                'http://news.sohu.com/20161110/n472858360.shtml',
                'http://news.sohu.com/20161017/n470448178.shtml',
                'http://news.sohu.com/upload/itoolbar/channel/itoolbar.201312131742.css',
                'http://news.sohu.com/s2014/shanghe2/index.shtml',
                'http://news.sohu.com/s2014/xijinpingfmg/index.shtml',
                'http://news.sohu.com/s2014/southa/',
                'http://news.sohu.com/s2014/xijinpingfh/index.shtml',
                'http://news.sohu.com/s2014/shanghe2/',
                'http://news.sohu.com/20150512/n412919660.shtml',
                'http://news.sohu.com/s2016/dianji-1924/index.shtml',
                'http://news.sohu.com/20161017/+e(u.href)+',
                'http://news.sohu.com/20161017/',
                'http://news.sohu.com/20160923/n469025923.shtml',
                'http://news.sohu.com/20161109/n472724936.shtml',
                'http://news.sohu.com/20161109/n472707790.shtml',
                'http://news.sohu.com/20161111/n472928697.shtml',
                'http://news.sohu.com/20160828/',
                'http://news.sohu.com/20110704/',
                'http://news.sohu.com/20120313/n337542775.shtml',
                'http://news.sohu.com/20161014/n470226628.shtml',
                'http://news.sohu.com/20161008/n469716006.shtml',
                'http://news.sohu.com/20161025/n471280304.shtml',
                'http://news.sohu.com/20161021/n470868817.shtml',
                'http://news.sohu.com/20110414/',
                'http://news.sohu.com/20110321/n279924541.shtml',
                'http://news.sohu.com/20161104/n472253207.shtml',
                'http://news.sohu.com/20151117/',
                'http://news.sohu.com/s2016/dianji-1921/index.shtml',
                'http://news.sohu.com/20160906/n467772530.shtml',
                'http://news.sohu.com/20160711/n458607512.shtml',
                'http://news.sohu.com/20051125/n227589828.shtml',
                'http://news.sohu.com/20051123/n227569646.shtml',
                'http://news.sohu.com/20051122/n227559017.shtml',
                'http://news.sohu.com/20161012/n470032195.shtml',
                'http://news.sohu.com/20130215/+e(u.href)+',
                'http://news.sohu.com/upload/zhengyufeng/css/g.css',
                'http://news.sohu.com/20161112/n472994745.shtml',
                'http://news.sohu.com/20161110/n472833318.shtml',
                'http://news.sohu.com/20170627/n498885071.shtml',
                'http://news.sohu.com/20161021/+e(u.href)+',
                'http://news.sohu.com/20161029/+e(u.href)+',
                'http://news.sohu.com/20161026/n471352892.shtml',
                'http://news.sohu.com/20160922/n468949304.shtml',
                'http://news.sohu.com/20160930/n469428812.shtml',
                'http://news.sohu.com/20180320/+e(u.href)+',
                'http://news.sohu.com/20170316/n483493382.shtml',
                'http://news.sohu.com/20170315/n483425147.shtml',
                'http://news.sohu.com/20170314/n483242951.shtml',
                'http://news.sohu.com/20170312/n483086486.shtml',
                'http://news.sohu.com/20161024/n471091439.shtml',
                'http://news.sohu.com/20161019/n470706855.shtml',
                'http://news.sohu.com/20141123/n406285941.shtml',
                'http://news.sohu.com/20141123/n406293219.shtml',
                'http://news.sohu.com/20161020/+e(u.href)+',
                'http://news.sohu.com/s2017/dlfj/index.shtml',
                'http://news.sohu.com/20170508/+e(u.href)+',
                'http://news.sohu.com/20170508/',
                'http://news.sohu.com/20170508/n492133958.shtml',
                'http://news.sohu.com/20170508/n492133371.shtml',
                'http://news.sohu.com/20161107/n472475447.shtml',
                'http://news.sohu.com/20161107/n472472989.shtml',
                'http://news.sohu.com/20161107/n472468742.shtml',
                'http://news.sohu.com/20161104/n472273079.shtml',
                'http://news.sohu.com/20170329/n485338994.shtml',
                'http://news.sohu.com/1/0504/52/subject220075299.shtml',
                'http://news.sohu.com/20161023/+e(u.href)+',
                'http://news.sohu.com/20161028/+e(u.href)+',
                'http://news.sohu.com/20161030/n471769981.shtml',
                'http://news.sohu.com/20180215/+e(u.href)+',
                'http://news.sohu.com/20161113/n473038840.shtml',
                'http://news.sohu.com/20170223/+e(u.href)+',
                'http://news.sohu.com/s2005/rwwangxf.shtml',
                'http://news.sohu.com/s2005/6829/s226016844.shtml',
                'http://news.sohu.com/20051130/n227631671.shtml',
                'http://news.sohu.com/20161210/n475474227.shtml',
                'http://news.sohu.com/20120313/',
                'http://news.sohu.com/20120312/n337470003.shtml',
                'http://news.sohu.com/20161105/n472358360.shtml',
                'http://news.sohu.com/20161105/n472353464.shtml',
                'http://news.sohu.com/20161103/n472186813.shtml',
                'http://news.sohu.com/20161015/n470360620.shtml',
                'http://news.sohu.com/20160920/n468795999.shtml',
                'http://news.sohu.com/s2016/dianji-1918/index.shtml',
                'http://news.sohu.com/20161112/n473004513.shtml',
                'http://news.sohu.com/s2017/4912/s482559338/index.shtml',
                'http://news.sohu.com/s2016/dianji-1916/index.shtml',
                'http://news.sohu.com/s2016/dianji-1915/index.shtml',
                'http://news.sohu.com/20161024/m.sohu.com/a/285430025_120078003',
                'http://news.sohu.com/20140728/n402808184.shtml',
                'http://news.sohu.com/20140726/n402767124.shtml',
                'http://news.sohu.com/20140724/n402693964.shtml',
                'http://news.sohu.com/20140724/n402678855.shtml',
                'http://news.sohu.com/20140918/n404439556.shtml',
                'http://news.sohu.com/20140705/n401821705.shtml',
                'http://news.sohu.com/20140706/n401840578.shtml',
                'http://news.sohu.com/20140824/n403719319.shtml',
                'http://news.sohu.com/20140911/n404240744.shtml',
                'http://news.sohu.com/20170216/n480872683.shtml',
                'http://news.sohu.com/20161009/+e(u.href)+',
                'http://news.sohu.com/20161009/',
                'http://news.sohu.com/20161110/n472857411.shtml',
                'http://news.sohu.com/20161031/+e(u.href)+',
                'http://news.sohu.com/20161101/n472045059.shtml',
                'http://news.sohu.com/20161013/n470140057.shtml',
                'http://news.sohu.com/20170310/n482888691.shtml',
                'http://news.sohu.com/20170310/n482873416.shtml',
                'http://news.sohu.com/20161110/n472831267.shtml',
                'http://news.sohu.com/20161024/+e(u.href)+',
                'http://news.sohu.com/20161109/n472693412.shtml',
                'http://news.sohu.com/20161109/n472656229.shtml',
                'http://news.sohu.com/20170411/n487811897.shtml',
                'http://news.sohu.com/20161110/n472857221.shtml',
                'http://news.sohu.com/upload/2013/global1026.css',
                'http://news.sohu.com/20160923/+e(u.href)+',
                'http://news.sohu.com/20150512/+e(u.href)+',
                'http://news.sohu.com/s2016/dianji-1913/index.shtml',
                'http://news.sohu.com/20161109/n472678478.shtml',
                'http://news.sohu.com/20161109/n472678367.shtml',
                'http://news.sohu.com/20141224/',
                'http://news.sohu.com/20110321/',
                'http://news.sohu.com/20110314/n279804163.shtml',
                'http://news.sohu.com/20160906/+e(u.href)+',
                'http://news.sohu.com/20161020/n470783131.shtml',
                'http://news.sohu.com/20161018/n470531275.shtml',
                'http://news.sohu.com/20161008/+e(u.href)+',
                'http://news.sohu.com/20161109/n472710409.shtml',
                'http://news.sohu.com/20161109/n472704832.shtml',
                'http://news.sohu.com/20161110/n472765013.shtml',
                'http://news.sohu.com/20161014/+e(u.href)+',
                'http://news.sohu.com/20161014/',
                'http://news.sohu.com/20081225/n261423467.shtml',
                'http://news.sohu.com/20081224/n261406030.shtml',
                'http://news.sohu.com/20051201/n227635298.shtml',
                'http://news.sohu.com/20161011/n470015977.shtml',
                'http://news.sohu.com/20160711/+e(u.href)+',
                'http://news.sohu.com/20161102/n472104285.shtml',
                'http://news.sohu.com/difangxinweng.shtml',
                'http://news.sohu.com/news_scrollnews.shtml',
                'http://news.sohu.com/20051117/n227517265.shtml',
                'http://news.sohu.com/20170627/+e(u.href)+',
                'http://news.sohu.com/20170627/',
                'http://news.sohu.com/s2016/xjpzglz/index.shtml',
                'http://news.sohu.com/20170814/n506637473.shtml',
                'http://news.sohu.com/s2005/ozqlgmy.shtml',
                'http://news.sohu.com/20120210/',
                'http://news.sohu.com/20170310/n482913605.shtml',
                'http://news.sohu.com/20160922/+e(u.href)+',
                'http://news.sohu.com/20160922/',
                'http://news.sohu.com/20161026/n471327815.shtml',
                'http://news.sohu.com/20141123/+e(u.href)+',
                'http://news.sohu.com/20180304/+e(u.href)+',
                'http://news.sohu.com/20180304/',
                'http://news.sohu.com/20170314/+e(u.href)+',
                'http://news.sohu.com/20170314/',
                'http://news.sohu.com/20051201/n227634249.shtml',
                'http://news.sohu.com/20170314/n483348868.shtml',
                'http://news.sohu.com/20160930/+e(u.href)+',
                'http://news.sohu.com/20050620/n226016845.shtml',
                'http://news.sohu.com/20050620/n226016846.shtml',
                'http://news.sohu.com/20050620/n226016856.shtml',
                'http://news.sohu.com/20161108/n472619904.shtml',
                'http://news.sohu.com/20161104/n472256490.shtml',
                'http://news.sohu.com/20161114/n473075739.shtml',
                'http://news.sohu.com/20161113/n473029220.shtml',
                'http://news.sohu.com/20160918/n468653436.shtml',
                'http://news.sohu.com/20170329/+e(u.href)+',
                'http://news.sohu.com/20161107/n472465721.shtml',
                'http://news.sohu.com/20161107/n472462543.shtml']
        self.loop = loop

        tasks = asyncio.gather(  # gather() 可以将一些 future 和协程封装成一个 future
            asyncio.ensure_future(self.run(), loop=loop),# ensure_future() 可以将一个协程封装成一个 Task
        )
        return tasks

    def start(self):
        loop = asyncio.get_event_loop()
        try:
            loop.run_until_complete(self.main(loop))
        except:
            loop.close()


if __name__ == '__main__':
    import time
    start = time.time()
    crawler = Crawleruning()
    crawler.start()
    end = time.time()
    print("用时",end-start)








